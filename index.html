<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SBS Board Meeting</title>
<style>
body{margin:0;font-family:Inter,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;background:#eef2ff;}
#landing{display:flex;flex-direction:column;align-items:center;gap:12px;background:#fff;padding:30px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.1);max-width:360px;text-align:center;}
input{padding:12px 14px;border-radius:12px;border:1px solid #ccc;font-size:1rem;width:100%;}
button{padding:12px 24px;border:none;border-radius:12px;background:#2563eb;color:#fff;font-size:1rem;cursor:pointer;font-weight:600;width:100%;}
#jitsi-container{width:100vw;height:100vh;display:none;position:fixed;top:0;left:0;}
#linkOutput{word-break:break-all;color:#2563eb;font-size:0.9rem;margin-top:8px;}
#copyBtn{padding:10px 20px;margin-top:6px;background:#10b981;color:#fff;border:none;border-radius:12px;cursor:pointer;display:none;}
</style>
</head>
<body>

<div id="landing">
  <h2>SBS Board Meeting</h2>
  <input id="displayName" placeholder="Enter your name"/>
  <input id="roomInput" placeholder="Enter a room name (host only)"/>
  <button id="generateLinkBtn">Generate Meeting Link</button>
  <div id="linkOutput"></div>
  <button id="copyBtn">Copy Link</button>
  <button id="joinBtn" style="display:none">Join Meeting</button>
</div>

<div id="jitsi-container"></div>

<script src="https://meet.jit.si/external_api.js"></script>
<script>
// Elements
const landing=document.getElementById('landing');
const container=document.getElementById('jitsi-container');
const displayNameInput=document.getElementById('displayName');
const roomInput=document.getElementById('roomInput');
const generateLinkBtn=document.getElementById('generateLinkBtn');
const joinBtn=document.getElementById('joinBtn');
const linkOutput=document.getElementById('linkOutput');
const copyBtn=document.getElementById('copyBtn');

let roomName=null;
let hostToken=null; // used to mark first user as host

// URL params
const urlParams=new URLSearchParams(window.location.search);
const roomParam=urlParams.get("room");
const nameParam=urlParams.get("name");
const hostParam=urlParams.get("host");

// Init Jitsi
function initJitsi(room, displayName){
  landing.style.display='none';
  container.style.display='block';
  const options={
    roomName:room,
    parentNode:container,
    configOverwrite:{
      startWithAudioMuted:false,
      startWithVideoMuted:false,
      disableDeepLinking:true
    },
    interfaceConfigOverwrite:{
      SHOW_JITSI_WATERMARK:false,
      SHOW_WATERMARK_FOR_GUESTS:false,
      HIDE_DEEP_LINKING_LOGO:true,
      TOOLBAR_BUTTONS:[
        'microphone','camera','desktop','fullscreen','hangup','chat',
        'recording','etherpad','sharedvideo','settings','raisehand',
        'videoquality','tileview','participants-pane','livestreaming','security'
      ]
    }
  };
  const api=new JitsiMeetExternalAPI('meet.jit.si',options);
  api.executeCommand('displayName',displayName);
}

// Host generates link
generateLinkBtn.addEventListener('click',()=>{
  const displayName=displayNameInput.value.trim();
  const room=roomInput.value.trim();
  if(!displayName || !room){ alert("Enter your name and room name"); return;}
  roomName=room;
  hostToken=Math.random().toString(36).substr(2,8); // generate a host token
  const link=`${window.location.origin}${window.location.pathname}?room=${encodeURIComponent(room)}&name=${encodeURIComponent(displayName)}&host=${hostToken}`;
  linkOutput.textContent="Share this link with participants:\n"+link;
  joinBtn.style.display='block';
  copyBtn.style.display='inline-block';
  copyBtn.dataset.link=link;
});

// Copy link
copyBtn.addEventListener('click',()=>{
  const link=copyBtn.dataset.link;
  navigator.clipboard.writeText(link).then(()=>alert('Meeting link copied!')).catch(err=>alert('Copy failed: '+err));
});

// Join meeting
joinBtn.addEventListener('click',()=>{
  const displayName=displayNameInput.value.trim();
  if(!displayName){ alert("Enter your name"); return;}
  const room=roomName || roomParam;
  initJitsi(room, displayName);
});

// Auto-join if link used
if(roomParam && nameParam){
  displayNameInput.value=nameParam;
  // Save host token locally if available
  if(hostParam) hostToken=hostParam;
  initJitsi(roomParam,nameParam);
}
</script>

</body>
</html>
